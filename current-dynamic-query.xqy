for $fact in doc("factProductSales.xml")//ProductSale, $cust in doc("dimcust.xml")//customer where $fact/customer_id=$cust/CustomerID group by $d:=$fact/customer_id order by $d return concat("&#xA;", "customer_id = ", $d, "&#x9;", "customer_name = ", string($cust/CustomerName),"&#x9;", "total_quantity_sold = ", sum($fact/quantity), "&#x9;", "total_cost_price= ", sum($fact/product_actual_cost), "&#x9;", "total_selling_price= ", sum($fact/sales_total_cost),  "&#x9;", "total_profit= ", sum($fact/sales_total_cost)-sum($fact/product_actual_cost), "&#xA;")